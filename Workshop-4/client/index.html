<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css"
    integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
  <title>Teacher & Course Management</title>
</head>

<body>
  <h1>Teacher & Course Management</h1>

  <h2>Add a Teacher</h2>
  <form id="teacherForm" class="border border-black p-3">
    <input type="text" id="first_name" class="form-control mb-2" placeholder="First Name" required>
    <input type="text" id="last_name" class="form-control mb-2" placeholder="Last Name" required>
    <input type="number" id="age" class="form-control mb-2" placeholder="Age" required>
    <input type="text" id="cedula" class="form-control mb-2" placeholder="Cedula" required>
    <button type="submit" class="btn btn-primary">Add Teacher</button>
  </form>

  <h2>All Teachers</h2>
  <table class="table table-hover">
    <thead class="thead-dark">
      <tr>
        <th>First Name</th>
        <th>Last Name</th>
        <th>Age</th>
        <th>Cedula</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="teacherTable"></tbody>
  </table>

  <h2>Add a Course</h2>
  <form id="courseForm" class="border border-black p-3">
    <input type="text" id="name" class="form-control mb-2" placeholder="Course Name" required>
    <input type="text" id="code" class="form-control mb-2" placeholder="Course Code" required>
    <input type="text" id="description" class="form-control mb-2" placeholder="Description" required>
    <select id="teacher" class="form-control mb-2"></select>
    <button type="submit" class="btn btn-primary">Add Course</button>
  </form>

  <h2>All Courses</h2>
  <table class="table table-hover">
    <thead class="thead-dark">
      <tr>
        <th>Name</th>
        <th>Code</th>
        <th>Description</th>
        <th>Teacher</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="courseTable"></tbody>
  </table>

  <script>
    async function fetchTeachers() {
      const response = await fetch("http://localhost:3000/teachers");
      const teachers = await response.json();
      const table = document.getElementById("teacherTable");
      table.innerHTML = "";
      teachers.forEach(teacher => {
        table.innerHTML += `
            <tr>
                <td>${teacher.first_name}</td>
                <td>${teacher.last_name}</td>
                <td>${teacher.age}</td>
                <td>${teacher.cedula}</td>
                <td>
                    <button onclick="editTeacher('${teacher._id}')" class="btn btn-warning">Edit</button>
                    <button onclick="deleteTeacher('${teacher._id}')" class="btn btn-danger">Delete</button>
                </td>
            </tr>`;
      });
    }


    async function fetchCourses() {
      const response = await fetch("http://localhost:3000/courses");
      const courses = await response.json();
      const table = document.getElementById("courseTable");
      table.innerHTML = "";
      courses.forEach(course => {
        const teacherName = course.teacher ? `${course.teacher.first_name} ${course.teacher.last_name}` : "No Teacher";
        table.innerHTML += `
            <tr>
                <td>${course.name}</td>
                <td>${course.code}</td>
                <td>${course.description}</td>
                <td>${teacherName}</td>
                <td>
                    <button onclick="editCourse('${course._id}')" class="btn btn-warning">Edit</button>
                    <button onclick="deleteCourse('${course._id}')" class="btn btn-danger">Delete</button>
                </td>
            </tr>`;
      });
    }

    document.getElementById("teacherForm").addEventListener("submit", async function (event) {
      event.preventDefault();
      const first_name = document.getElementById("first_name").value;
      const last_name = document.getElementById("last_name").value;
      const age = document.getElementById("age").value;
      const cedula = document.getElementById("cedula").value;
      await fetch("http://localhost:3000/teachers", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ first_name, last_name, age, cedula })
      });
      fetchTeachers();
    });

    document.getElementById("courseForm").addEventListener("submit", async function (event) {
      event.preventDefault();
      const name = document.getElementById("name").value;
      const code = document.getElementById("code").value;
      const description = document.getElementById("description").value;
      const teacher = document.getElementById("teacher").value; // Debe ser un ObjectId

      if (!teacher || teacher.length !== 24) {
        alert("Please select a valid teacher");
        return;
      }

      await fetch("http://localhost:3000/courses", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name, code, description, teacher })
      });

      fetchCourses();
    });

    async function deleteTeacher(id) {
      await fetch(`http://localhost:3000/teachers?id=${id}`, { method: "DELETE" });
      fetchTeachers();
    }

    async function deleteCourse(id) {
      await fetch(`http://localhost:3000/courses?id=${id}`, { method: "DELETE" });
      fetchCourses();
    }

    async function editTeacher(id) {
      const newFirstName = prompt("Enter new First Name:");
      const newLastName = prompt("Enter new Last Name:");
      const newAge = prompt("Enter new Age:");
      const newCedula = prompt("Enter new Cedula:");

      if (newFirstName && newLastName && newAge && newCedula) {
        await fetch(`http://localhost:3000/teachers?id=${id}`, {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            first_name: newFirstName,
            last_name: newLastName,
            age: newAge,
            cedula: newCedula
          })
        });

        fetchTeachers();
      }
    }

    async function editCourse(id) {
      const newName = prompt("Enter new Course Name:");
      const newCode = prompt("Enter new Course Code:");
      const newDescription = prompt("Enter new Description:");

      if (newName && newCode && newDescription) {
        await fetch(`http://localhost:3000/courses?id=${id}`, {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            name: newName,
            code: newCode,
            description: newDescription
          })
        });

        fetchCourses();
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      fetchTeachers();
      fetchCourses();
    });
  </script>
</body>

</html>